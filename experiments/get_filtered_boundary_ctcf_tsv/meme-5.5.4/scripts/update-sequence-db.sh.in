#!/bin/sh

# See if we are doing an update or just getting information.
help="false"
list_rel="false"
update="false"
for arg in $@ ; do
  if [ $arg == "--help" ] ; then help="true" ; fi
  if [ $arg == "--list_rel" ] ; then list_rel="true" ; fi
  if [[ $arg == "--db_regexp" ]] || [[ $arg == "--db_all" ]] ; then update="true" ; fi
done
if [[ $help == "true" ]] || [[ $list_rel == "true" ]] ; then update="false" ; fi

# Run index-sequence-db if Signal and we did an update.
run_index_sequence_db() {
  if [ "$update" == "true" ]; then
    echo "Updating sequence file indices."
     @LIBEXECDIR@/index-sequence-db $1
  fi
}

# Make sure index-sequence-db gets run so partial database has all columns.
trap "run_index_sequence_db ${@:$#}" SIGINT

# Run updatedb.
echo java -jar @JAVALIBDIR@/updatedb.jar "$@"
java -jar @JAVALIBDIR@/updatedb.jar "$@"

# Index sequences if we did an update.
run_index_sequence_db ${@:$#}
